<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Euro Draws Lab</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="noise"></div>
  <header class="hero">
    <div class="badge">Labs Preview</div>
    <h1>Euromillions Insights</h1>
    <p class="lede">Visualisez les tendances, générez des combinaisons et comparez EUROMILLION et EURODREAM avec un tableau de bord moderne.</p>
    <div class="cta-row">
      <button class="btn primary">Generate smart picks</button>
      <button class="btn ghost">View history</button>
    </div>
    <div class="disclaimer">
      <strong>FR</strong> · Ce générateur est fourni à titre ludique. Aucun gain garanti.
      <span class="dot">•</span>
      <strong>EN</strong> · Entertainment-only generator. No winnings guaranteed.
    </div>
  </header>

  <main class="grid">
    <section class="card highlight">
      <div class="card-header">
        <h2>Games</h2>
        <span class="pill">Dual mode</span>
      </div>
      <div class="game-list">
        <article class="game">
          <div>
            <p class="eyebrow">EUROMILLION</p>
            <h3>Signature draws</h3>
            <p class="muted">5 numbers · 2 stars · 50/12 range</p>
          </div>
          <div class="tag success">live</div>
        </article>
        <article class="game">
          <div>
            <p class="eyebrow">EURODREAM</p>
            <h3>Experimental mode</h3>
            <p class="muted">5 numbers · 2 stars · 50/12 range</p>
          </div>
          <div class="tag neutral">beta</div>
        </article>
      </div>
    </section>

    <section class="card">
      <div class="card-header">
        <h2>Strategy picker</h2>
        <span class="pill soft">ML-ready</span>
      </div>
      <ul class="list">
        <li>
          <div>
            <p class="eyebrow">Frequency</p>
            <p class="muted">Choisit les numéros les plus fréquents + repli si peu de données.</p>
          </div>
          <button class="chip">Run</button>
        </li>
        <li>
          <div>
            <p class="eyebrow">Random</p>
            <p class="muted">Tirage aléatoire trié dans les bornes du jeu.</p>
          </div>
          <button class="chip">Run</button>
        </li>
        <li>
          <div>
            <p class="eyebrow">Custom</p>
            <p class="muted">Plug your model: API ready with /api/generate/&lt;strategie&gt;.</p>
          </div>
          <button class="chip hollow">Connect</button>
        </li>
      </ul>
    </section>

    <section class="card live">
      <div class="card-header">
        <h2>Live generator</h2>
        <span class="pill soft">API bridge</span>
      </div>
      <div class="form-grid">
        <label>
          <span class="eyebrow">Game</span>
          <select id="game">
            <option value="euromillion" selected>EUROMILLION</option>
            <option value="eurodream">EURODREAM</option>
          </select>
        </label>
        <label>
          <span class="eyebrow">Strategy</span>
          <select id="strategie">
            <option value="frequency" selected>frequency</option>
            <option value="random">random</option>
            <option value="fibo">fibo</option>
            <option value="mcc">mcc</option>
            <option value="spectre">spectre</option>
            <option value="meta_ia">meta_ia</option>
          </select>
        </label>
      </div>
      <label class="stack">
        <span class="eyebrow">History (JSON payload)</span>
        <textarea id="history" rows="6"></textarea>
      </label>
      <div class="cta-row gap">
        <button class="btn primary" id="run">Call API</button>
        <div class="status" id="status">Ready — use the sample payload or paste your own draws.</div>
      </div>
      <div class="result-grid" id="result" aria-live="polite"></div>
    </section>

    <section class="card">
      <div class="card-header">
        <h2>Latest insights</h2>
        <span class="pill soft">In-context</span>
      </div>
      <div class="insights">
        <div>
          <p class="eyebrow">Next-up numbers</p>
          <p class="figure">12 · 18 · 27 · 31 · 42</p>
          <p class="muted">Confidence 72% · sliding window 20 draws</p>
        </div>
        <div>
          <p class="eyebrow">Stars</p>
          <p class="figure">3 · 11</p>
          <p class="muted">Gap-weighted prediction</p>
        </div>
      </div>
    </section>

    <section class="card">
      <div class="card-header">
        <h2>Responsible play</h2>
        <span class="pill soft">Safety</span>
      </div>
      <div class="responsible">
        <p>FR · Jouez de manière responsable, fixez des limites et ne misez jamais plus que ce que vous pouvez vous permettre de perdre.</p>
        <p>EN · Play responsibly, set limits, and never stake more than you can afford to lose.</p>
      </div>
    </section>
  </main>
  <script>
    const historyField = document.getElementById("history");
    const statusEl = document.getElementById("status");
    const resultEl = document.getElementById("result");
    const gameField = document.getElementById("game");
    const strategyField = document.getElementById("strategie");

    const samplePayload = {
      draws: [
        { numbers: [3, 11, 19, 24, 45], stars: [4, 11] },
        { numbers: [5, 18, 27, 32, 42], stars: [2, 10] },
        { numbers: [1, 7, 21, 28, 49], stars: [3, 6] },
      ],
      game: "euromillion",
    };

    historyField.value = JSON.stringify(samplePayload, null, 2);

    const API_BASE = window.location.origin && window.location.origin !== "null"
      ? window.location.origin
      : "http://localhost:8000";

    document.getElementById("run").addEventListener("click", async () => {
      let payload;
      try {
        payload = JSON.parse(historyField.value || "{}");
        payload.game = gameField.value;
      } catch (err) {
        statusEl.textContent = "Payload invalide : veuillez fournir un JSON valide.";
        statusEl.classList.add("error");
        return;
      }

      const strategie = strategyField.value;
      statusEl.textContent = "Calling /api/generate/" + strategie + " ...";
      statusEl.classList.remove("error");
      resultEl.innerHTML = "";

      try {
        const response = await fetch(`${API_BASE}/api/generate/${strategie}`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });

        const body = await response.json();
        if (!response.ok) {
          statusEl.textContent = `Erreur ${response.status} : ${body.detail || "échec de l'appel"}`;
          statusEl.classList.add("error");
          return;
        }

        statusEl.textContent = "Réponse reçue";
        statusEl.classList.remove("error");
        resultEl.innerHTML = `
          <div class="result-card">
            <div>
              <p class="eyebrow">Numbers</p>
              <div class="chips">${body.numbers.map((n) => `<span class="chip">${n}</span>`).join("")}</div>
            </div>
            <div>
              <p class="eyebrow">Stars</p>
              <div class="chips">${body.stars.map((n) => `<span class="chip">${n}</span>`).join("")}</div>
            </div>
            <div>
              <p class="eyebrow">Confidence</p>
              <p class="figure">${(body.confidence_score * 100).toFixed(1)}%</p>
            </div>
            <div>
              <p class="eyebrow">Method</p>
              <p class="muted">${body.method_used}</p>
            </div>
          </div>
          <div class="result-card muted-block">
            <p class="eyebrow">Explanation</p>
            <p class="muted">${body.explanation}</p>
            <p class="eyebrow">Features</p>
            <pre>${JSON.stringify(body.features, null, 2)}</pre>
          </div>
        `;
      } catch (err) {
        console.error(err);
        statusEl.textContent = "API inaccessible : démarrez le backend (uvicorn main:app --reload).";
        statusEl.classList.add("error");
      }
    });
  </script>
</body>
</html>
